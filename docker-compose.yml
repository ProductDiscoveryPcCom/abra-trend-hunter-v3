version: '3.8'

services:
  abra-trend-hunter:
    build: .
    container_name: abra-trend-hunter
    ports:
      - "8501:8501"
    environment:
      # Requerido
      - SERPAPI_KEY=${SERPAPI_KEY}
      - PASSWORD=${PASSWORD:-admin123}
      
      # Opcional: YouTube
      - YOUTUBE_API_KEY=${YOUTUBE_API_KEY:-}
      
      # Opcional: IA
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - PERPLEXITY_API_KEY=${PERPLEXITY_API_KEY:-}
      
      # Opcional: Cach√© Supabase
      - SUPABASE_URL=${SUPABASE_URL:-}
      - SUPABASE_KEY=${SUPABASE_KEY:-}
      
      # Opcional: Email
      - SMTP_SERVER=${SMTP_SERVER:-}
      - SMTP_PORT=${SMTP_PORT:-587}
      - SMTP_USER=${SMTP_USER:-}
      - SMTP_PASSWORD=${SMTP_PASSWORD:-}
      
      # Opcional: Google Ads
      - GOOGLE_ADS_DEVELOPER_TOKEN=${GOOGLE_ADS_DEVELOPER_TOKEN:-}
      - GOOGLE_ADS_CLIENT_ID=${GOOGLE_ADS_CLIENT_ID:-}
      - GOOGLE_ADS_CLIENT_SECRET=${GOOGLE_ADS_CLIENT_SECRET:-}
      - GOOGLE_ADS_REFRESH_TOKEN=${GOOGLE_ADS_REFRESH_TOKEN:-}
      - GOOGLE_ADS_CUSTOMER_ID=${GOOGLE_ADS_CUSTOMER_ID:-}
    
    volumes:
      # Montar secrets si existe archivo local
      - ./.streamlit/secrets.toml:/app/.streamlit/secrets.toml:ro
    
    restart: unless-stopped
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

# Para desarrollo con hot reload
# docker-compose -f docker-compose.yml -f docker-compose.dev.yml up
